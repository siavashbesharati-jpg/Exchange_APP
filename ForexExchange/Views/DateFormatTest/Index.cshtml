@model ForexExchange.Controllers.DateFormatTestViewModel

@{
    ViewData["Title"] = "ØªØ³Øª ÙØ±Ù…Øª ØªØ§Ø±ÛŒØ® - ÛŒÚ©Ø³Ø§Ù†â€ŒØ³Ø§Ø²ÛŒ Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ®";
}

<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="mb-1">ØªØ³Øª ÙØ±Ù…Øª ØªØ§Ø±ÛŒØ® ÛŒÚ©Ø³Ø§Ù†</h2>
            <div class="text-muted small">Ù†Ù…Ø§ÛŒØ´ ÛŒÚ©Ø³Ø§Ù† ØªØ§Ø±ÛŒØ® Ø¯Ø± ØªÙ…Ø§Ù…ÛŒ Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± - ÙØ±Ù…Øª Ø±ÙˆØ²-Ù…Ø§Ù‡-Ø³Ø§Ù„</div>
        </div>
    </div>

    <div class="row">
        <!-- Application Configuration -->
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-cog"></i> ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ø§Ø±Ø¨Ø±Ø¯</h5>
                </div>
                <div class="card-body">
                    <table class="table table-sm">
                        <tr>
                            <td><strong>ÙØ±Ù…Øª Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ®:</strong></td>
                            <td><code>@Model.DateDisplayFormat</code></td>
                        </tr>
                        <tr>
                            <td><strong>ÙØ±Ù…Øª Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ® Ùˆ Ø²Ù…Ø§Ù†:</strong></td>
                            <td><code>@Model.DateTimeDisplayFormat</code></td>
                        </tr>
                        <tr>
                            <td><strong>ÙØ±Ù‡Ù†Ú¯ (Culture):</strong></td>
                            <td><code>fa-IR (Persian/Iran)</code></td>
                        </tr>
                        <tr>
                            <td><strong>Ø¬Ù‡Øª Ù…ØªÙ†:</strong></td>
                            <td><code>RTL (Ø±Ø§Ø³Øª Ø¨Ù‡ Ú†Ù¾)</code></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <!-- Current Values -->
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-calendar"></i> Ù…Ù‚Ø§Ø¯ÛŒØ± ÙØ¹Ù„ÛŒ</h5>
                </div>
                <div class="card-body">
                    <table class="table table-sm">
                        <tr>
                            <td><strong>ØªØ§Ø±ÛŒØ® Ø§Ù…Ø±ÙˆØ²:</strong></td>
                            <td><span class="badge bg-primary">@Model.CurrentDateDisplay</span></td>
                        </tr>
                        <tr>
                            <td><strong>ØªØ§Ø±ÛŒØ® Ùˆ Ø²Ù…Ø§Ù† ÙØ¹Ù„ÛŒ:</strong></td>
                            <td><span class="badge bg-info">@Model.CurrentDateTimeDisplay</span></td>
                        </tr>
                        <tr>
                            <td><strong>ØªØ§Ø±ÛŒØ® Ø®Ø§Ù… (DateTime.Now):</strong></td>
                            <td><span class="badge bg-secondary">@Model.CurrentDate</span></td>
                        </tr>
                        <tr>
                            <td><strong>Ù†Ù…ÙˆÙ†Ù‡ ØªØ§Ø±ÛŒØ®:</strong></td>
                            <td><span class="badge bg-warning text-dark">@Model.SampleDate.ToDisplayDate()</span></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Date Formatting Examples -->
    <div class="card mb-4">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0"><i class="fas fa-list"></i> Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ±Ù…Øªâ€ŒØ¨Ù†Ø¯ÛŒ ØªØ§Ø±ÛŒØ®</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th>
                            <th>Ù†ØªÛŒØ¬Ù‡</th>
                            <th>Ù†ÙˆØ¹ ÙØ±Ù…Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var example in Model.Examples)
                        {
                            <tr>
                                <td>@example.Description</td>
                                <td><code class="text-primary">@example.Value</code></td>
                                <td>
                                    @if (example.Value.Contains("/"))
                                    {
                                        <span class="badge bg-success">Day-Month-Year âœ“</span>
                                    }
                                    else if (example.Value.Contains("-"))
                                    {
                                        <span class="badge bg-warning text-dark">ISO Format</span>
                                    }
                                    else if (string.IsNullOrEmpty(example.Value))
                                    {
                                        <span class="badge bg-secondary">Empty/Null</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-info">Other Format</span>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Interactive Date Parsing Test -->
    <div class="card mb-4">
        <div class="card-header bg-warning text-dark">
            <h5 class="mb-0"><i class="fas fa-test-tube"></i> ØªØ³Øª ØªØ¬Ø²ÛŒÙ‡ ØªØ§Ø±ÛŒØ®</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-8">
                    <label for="dateTestInput" class="form-label">ØªØ§Ø±ÛŒØ® Ø±Ø§ Ø¨Ù‡ ÙØ±Ù…Øª Ø±ÙˆØ²/Ù…Ø§Ù‡/Ø³Ø§Ù„ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="dateTestInput" 
                               placeholder="Ù…Ø«Ø§Ù„: 25/12/2024 ÛŒØ§ 01/01/1403" />
                        <button class="btn btn-primary" type="button" onclick="testDateParsing()">
                            <i class="fas fa-check"></i> ØªØ³Øª
                        </button>
                    </div>
                    <small class="form-text text-muted">
                        ÙØ±Ù…Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø´Ø¯Ù‡: dd/MM/yyyyØŒ dd-MM-yyyyØŒ dd.MM.yyyyØŒ d/M/yyyy
                    </small>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¹ØªØ¨Ø±:</label>
                    <div class="small">
                        <code>25/12/2024</code><br>
                        <code>01-01-2024</code><br>
                        <code>5.3.2024</code><br>
                        <code>15/06/1403</code>
                    </div>
                </div>
            </div>
            <div id="parseResult" class="mt-3" style="display: none;">
                <!-- Result will be shown here -->
            </div>
        </div>
    </div>

    <!-- HTML Date Input Demo -->
    <div class="card mb-4">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0"><i class="fas fa-calendar-alt"></i> Ù†Ù…Ø§ÛŒØ´ ÙˆØ±ÙˆØ¯ÛŒ ØªØ§Ø±ÛŒØ® HTML5</h5>
        </div>
        <div class="card-body">
            <p class="text-muted">Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù†Ø­ÙˆÙ‡ Ø¹Ù…Ù„Ú©Ø±Ø¯ ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ÛŒ ØªØ§Ø±ÛŒØ® HTML5 Ø±Ø§ Ø¨Ø§ ÙØ±Ù…Øª ÛŒÚ©Ø³Ø§Ù† Ø±ÙˆØ²-Ù…Ø§Ù‡-Ø³Ø§Ù„ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯:</p>
            
            <div class="row">
                <div class="col-md-6">
                    <label for="testDateInput" class="form-label">Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§Ø±ÛŒØ® (type="date"):</label>
                    <input type="date" class="form-control" id="testDateInput" />
                    <small class="form-text text-muted">ÙØ±Ù…Øª Ù†Ù…Ø§ÛŒØ´: Ø±ÙˆØ²/Ù…Ø§Ù‡/Ø³Ø§Ù„</small>
                </div>
                <div class="col-md-6">
                    <label for="testDateTimeInput" class="form-label">Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§Ø±ÛŒØ® Ùˆ Ø²Ù…Ø§Ù† (type="datetime-local"):</label>
                    <input type="datetime-local" class="form-control" id="testDateTimeInput" />
                    <small class="form-text text-muted">ÙØ±Ù…Øª Ù†Ù…Ø§ÛŒØ´: Ø±ÙˆØ²/Ù…Ø§Ù‡/Ø³Ø§Ù„ + Ø²Ù…Ø§Ù†</small>
                </div>
            </div>
            
            <div class="mt-3">
                <button type="button" class="btn btn-secondary" onclick="setCurrentDateValues()">
                    <i class="fas fa-calendar-day"></i> ØªÙ†Ø¸ÛŒÙ… ØªØ§Ø±ÛŒØ® Ø§Ù…Ø±ÙˆØ²
                </button>
                <button type="button" class="btn btn-outline-secondary" onclick="clearDateValues()">
                    <i class="fas fa-eraser"></i> Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†
                </button>
            </div>
            
            <div id="dateInputResult" class="mt-3" style="display: none;">
                <div class="alert alert-info">
                    <strong>Ù…Ù‚Ø§Ø¯ÛŒØ± Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡:</strong>
                    <ul class="mb-0">
                        <li>ØªØ§Ø±ÛŒØ®: <span id="selectedDate">-</span></li>
                        <li>ØªØ§Ø±ÛŒØ® Ùˆ Ø²Ù…Ø§Ù†: <span id="selectedDateTime">-</span></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Consistency Information -->
    <div class="card">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0"><i class="fas fa-info-circle"></i> Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÛŒÚ©Ø³Ø§Ù†â€ŒØ³Ø§Ø²ÛŒ</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>âœ… ØªØºÛŒÛŒØ±Ø§Øª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡:</h6>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-check text-success"></i> Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† <code>DateTimeHelper</code> class</li>
                        <li><i class="fas fa-check text-success"></i> ØªÙ†Ø¸ÛŒÙ… ÙØ±Ù‡Ù†Ú¯ <code>fa-IR</code> Ø¯Ø± Program.cs</li>
                        <li><i class="fas fa-check text-success"></i> Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ <code>ToPersianDateTextify()</code></li>
                        <li><i class="fas fa-check text-success"></i> Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† extension methods ÛŒÚ©Ø³Ø§Ù†</li>
                        <li><i class="fas fa-check text-success"></i> ØªÙ†Ø¸ÛŒÙ… RequestLocalization middleware</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h6>ğŸ“ ÙØ±Ù…Øª Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯:</h6>
                    <div class="bg-light p-3 rounded">
                        <strong>Ø±ÙˆØ²-Ù…Ø§Ù‡-Ø³Ø§Ù„ (dd/MM/yyyy)</strong><br>
                        <small class="text-muted">
                            Ø§ÛŒÙ† ÙØ±Ù…Øª Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø§ÛŒØ±Ø§Ù†ÛŒ Ù…Ù†Ø§Ø³Ø¨â€ŒØªØ± Ùˆ Ø¢Ø´Ù†Ø§ØªØ± Ø§Ø³Øª.<br>
                            ØªÙ…Ø§Ù…ÛŒ ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§ Ø¯Ø± Ø³Ø±Ø§Ø³Ø± Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Ø¨Ù‡ Ø§ÛŒÙ† Ø´Ú©Ù„ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function testDateParsing() {
            const input = document.getElementById('dateTestInput');
            const resultDiv = document.getElementById('parseResult');
            const dateString = input.value.trim();
            
            if (!dateString) {
                showResult(false, 'Ù„Ø·ÙØ§Ù‹ ÛŒÚ© ØªØ§Ø±ÛŒØ® ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', null, null);
                return;
            }
            
            fetch('@Url.Action("TestParsing", "DateFormatTest")', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'dateString=' + encodeURIComponent(dateString)
            })
            .then(response => response.json())
            .then(data => {
                showResult(data.success, data.message, data.parsedDate, data.formattedBack);
            })
            .catch(error => {
                showResult(false, 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±: ' + error.message, null, null);
            });
        }
        
        function showResult(success, message, parsedDate, formattedBack) {
            const resultDiv = document.getElementById('parseResult');
            const alertClass = success ? 'alert-success' : 'alert-danger';
            const icon = success ? 'fa-check-circle' : 'fa-exclamation-triangle';
            
            let html = `
                <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
                    <i class="fas ${icon}"></i> ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            if (success && parsedDate && formattedBack) {
                html += `
                    <div class="table-responsive">
                        <table class="table table-sm table-bordered">
                            <tr>
                                <td><strong>ÙˆØ±ÙˆØ¯ÛŒ:</strong></td>
                                <td><code>${document.getElementById('dateTestInput').value}</code></td>
                            </tr>
                            <tr>
                                <td><strong>ØªØ§Ø±ÛŒØ® ØªØ¬Ø²ÛŒÙ‡ Ø´Ø¯Ù‡:</strong></td>
                                <td><code>${parsedDate}</code></td>
                            </tr>
                            <tr>
                                <td><strong>ÙØ±Ù…Øª ÛŒÚ©Ø³Ø§Ù†:</strong></td>
                                <td><code class="text-success">${formattedBack}</code></td>
                            </tr>
                        </table>
                    </div>
                `;
            }
            
            resultDiv.innerHTML = html;
            resultDiv.style.display = 'block';
        }
        
        // Test with Enter key
        document.getElementById('dateTestInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                testDateParsing();
            }
        });
        
        // Date input demo functions
        function setCurrentDateValues() {
            const now = new Date();
            const dateInput = document.getElementById('testDateInput');
            const dateTimeInput = document.getElementById('testDateTimeInput');
            
            if (window.ForexDateUtils) {
                dateInput.value = window.ForexDateUtils.formatInputDate(now);
                dateTimeInput.value = window.ForexDateUtils.formatInputDateTime(now);
            } else {
                // Fallback
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                
                dateInput.value = `${year}-${month}-${day}`;
                dateTimeInput.value = `${year}-${month}-${day}T${hours}:${minutes}`;
            }
            
            // Trigger change events
            dateInput.dispatchEvent(new Event('change'));
            dateTimeInput.dispatchEvent(new Event('change'));
            
            updateDateInputResult();
        }
        
        function clearDateValues() {
            document.getElementById('testDateInput').value = '';
            document.getElementById('testDateTimeInput').value = '';
            document.getElementById('dateInputResult').style.display = 'none';
        }
        
        function updateDateInputResult() {
            const dateInput = document.getElementById('testDateInput');
            const dateTimeInput = document.getElementById('testDateTimeInput');
            const resultDiv = document.getElementById('dateInputResult');
            const selectedDateSpan = document.getElementById('selectedDate');
            const selectedDateTimeSpan = document.getElementById('selectedDateTime');
            
            let hasValue = false;
            
            if (dateInput.value) {
                const date = new Date(dateInput.value);
                if (window.ForexDateUtils) {
                    selectedDateSpan.textContent = window.ForexDateUtils.formatDisplayDate(date);
                } else {
                    selectedDateSpan.textContent = date.toLocaleDateString('fa-IR');
                }
                hasValue = true;
            } else {
                selectedDateSpan.textContent = '-';
            }
            
            if (dateTimeInput.value) {
                const date = new Date(dateTimeInput.value);
                if (window.ForexDateUtils) {
                    selectedDateTimeSpan.textContent = window.ForexDateUtils.formatDisplayDate(date) + ' ' + 
                        date.toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit' });
                } else {
                    selectedDateTimeSpan.textContent = date.toLocaleString('fa-IR');
                }
                hasValue = true;
            } else {
                selectedDateTimeSpan.textContent = '-';
            }
            
            resultDiv.style.display = hasValue ? 'block' : 'none';
        }
        
        // Listen for changes on date inputs
        document.getElementById('testDateInput').addEventListener('change', updateDateInputResult);
        document.getElementById('testDateTimeInput').addEventListener('change', updateDateInputResult);
    </script>
}

<style>
    .badge {
        font-size: 0.9em;
    }
    
    code {
        background-color: #f8f9fa;
        padding: 0.2rem 0.4rem;
        border-radius: 0.25rem;
        border: 1px solid #dee2e6;
    }
    
    .card-header h5 {
        margin: 0;
    }
    
    .table th {
        border-top: none;
        font-weight: 600;
        background-color: #f8f9fa;
    }
</style>