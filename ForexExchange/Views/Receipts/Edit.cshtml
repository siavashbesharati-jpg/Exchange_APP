@model ForexExchange.Models.Receipt

@{
    ViewData["Title"] = "ویرایش رسید";
}

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4 class="card-title mb-0">ویرایش رسید #@Model.Id</h4>
                    <a asp-action="Details" asp-route-id="@Model.Id" class="btn btn-secondary">بازگشت</a>
                </div>
                <div class="card-body">
                    @if (TempData["ErrorMessage"] != null)
                    {
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            @TempData["ErrorMessage"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="بستن"></button>
                        </div>
                    }

                    <form asp-action="Edit" method="post" enctype="multipart/form-data">
                        <input type="hidden" asp-for="Id" />
                        <input type="hidden" asp-for="UploadedAt" />
                        <input type="hidden" asp-for="IsVerified" />
                        <input type="hidden" asp-for="VerifiedAt" />

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="CustomerId" class="form-label">مشتری</label>
                                <select asp-for="CustomerId" class="form-select" required>
                                    <option value="">انتخاب مشتری</option>
                                    @foreach (var customer in ViewBag.Customers as List<ForexExchange.Models.Customer>)
                                    {
                                        <option value="@customer.Id" selected="@(customer.Id == Model.CustomerId)">
                                            @customer.FullName - @customer.PhoneNumber
                                        </option>
                                    }
                                </select>
                                <span asp-validation-for="CustomerId" class="text-danger"></span>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label asp-for="Type" class="form-label">نوع رسید</label>
                                <select asp-for="Type" class="form-select" required>
                                    <option value="@ForexExchange.Models.ReceiptType.PaymentReceipt" selected="@(Model.Type == ForexExchange.Models.ReceiptType.PaymentReceipt)">رسید پرداخت</option>
                                    <option value="@ForexExchange.Models.ReceiptType.BankStatement" selected="@(Model.Type == ForexExchange.Models.ReceiptType.BankStatement)">گردش حساب</option>
                                </select>
                                <span asp-validation-for="Type" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="OrderId" class="form-label">سفارش (اختیاری)</label>
                                <select asp-for="OrderId" class="form-select">
                                    <option value="">بدون سفارش</option>
                                    @foreach (var order in ViewBag.Orders as List<ForexExchange.Models.Order>)
                                    {
                                        <option value="@order.Id" selected="@(order.Id == Model.OrderId)">
                                            #@order.Id - @order.Customer?.FullName (@order.CurrencyPair - @order.Amount.ToString("N0"))
                                        </option>
                                    }
                                </select>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label asp-for="TransactionId" class="form-label">تراکنش (اختیاری)</label>
                                <select asp-for="TransactionId" class="form-select">
                                    <option value="">بدون تراکنش</option>
                                    @foreach (var transaction in ViewBag.Transactions as List<ForexExchange.Models.Transaction>)
                                    {
                                        <option value="@transaction.Id" selected="@(transaction.Id == Model.TransactionId)">
                                            #@transaction.Id - @transaction.BuyerCustomer?.FullName / @transaction.SellerCustomer?.FullName
                                        </option>
                                    }
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="ParsedAmount" class="form-label">مبلغ</label>
                                <input asp-for="ParsedAmount" class="form-control" placeholder="مبلغ تراکنش" />
                                <span asp-validation-for="ParsedAmount" class="text-danger"></span>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label asp-for="ParsedReferenceId" class="form-label">شماره پیگیری</label>
                                <input asp-for="ParsedReferenceId" class="form-control" placeholder="شماره پیگیری تراکنش" />
                                <span asp-validation-for="ParsedReferenceId" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="ParsedDate" class="form-label">تاریخ تراکنش</label>
                                <input asp-for="ParsedDate" class="form-control" placeholder="تاریخ تراکنش" />
                                <span asp-validation-for="ParsedDate" class="text-danger"></span>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label asp-for="ParsedAccountNumber" class="form-label">شماره حساب</label>
                                <input asp-for="ParsedAccountNumber" class="form-control" placeholder="شماره حساب" />
                                <span asp-validation-for="ParsedAccountNumber" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Notes" class="form-label">توضیحات</label>
                            <textarea asp-for="Notes" class="form-control" rows="3" placeholder="توضیحات اضافی..."></textarea>
                            <span asp-validation-for="Notes" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label for="newReceiptFile" class="form-label">تصویر جدید رسید (اختیاری)</label>
                            <input type="file" class="form-control" id="newReceiptFile" name="newReceiptFile" accept="image/*">
                            <div class="form-text">اگر می‌خواهید تصویر رسید را تغییر دهید، فایل جدید انتخاب کنید.</div>
                        </div>

                        @if (Model.ImageData != null && Model.ImageData.Length > 0)
                        {
                            <div class="mb-3">
                                <label class="form-label">تصویر فعلی رسید</label>
                                <div class="border rounded p-2">
                                    <img src="@Url.Action("Image", new { id = Model.Id })" alt="Receipt" class="img-fluid" style="max-height: 200px;">
                                </div>
                            </div>
                        }

                        <div class="d-flex justify-content-between">
                            <a asp-action="Details" asp-route-id="@Model.Id" class="btn btn-secondary">انصراف</a>
                            <button type="submit" class="btn btn-primary">ذخیره تغییرات</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
