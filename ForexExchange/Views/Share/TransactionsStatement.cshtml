@model ForexExchange.Models.CustomerTransactionsStatementViewModel
@inject ForexExchange.Services.ISettingsService SettingsService
@inject ForexExchange.Services.IFileUploadService FileUploadService
@using ForexExchange.Extensions

@{
    ViewData["Title"] = "گزارش تراکنش‌های مشتری";
    Layout = null;
    
    // Get dynamic branding data directly from service
    var websiteName = await SettingsService.GetWebsiteNameAsync();
    var companyName = await SettingsService.GetCompanyNameAsync();
    var companyWebsite = await SettingsService.GetCompanyWebsiteAsync();
    var logoPath = await SettingsService.GetLogoPathAsync();
    var logoUrl = FileUploadService.GetLogoUrl(logoPath);
}

<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>گزارش تراکنش‌های مشتری - @Model.Customer.FullName - @websiteName</title>
    
    <!-- Dynamic Favicon -->
    <link rel="icon" type="image/png" href="@logoUrl">
    <link rel="shortcut icon" href="@logoUrl">
    
    <!-- Open Graph / WhatsApp Meta Tags -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="گزارش تراکنش‌های مشتری - @Model.Customer.FullName" />
    <meta property="og:description" content="گزارش تراکنش‌های مشتری از @websiteName - شامل تمام معاملات خرید و فروش ارز" />
    <meta property="og:image" content="@($"{Context.Request.Scheme}://{Context.Request.Host}{logoUrl}")" />
    <meta property="og:url" content="@($"{Context.Request.Scheme}://{Context.Request.Host}{Context.Request.Path}")" />
    <meta property="og:site_name" content="@websiteName" />
    <meta property="og:locale" content="fa_IR" />
    
    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="گزارش تراکنش‌های مشتری - @Model.Customer.FullName" />
    <meta name="twitter:description" content="گزارش تراکنش‌های مشتری از @websiteName" />
    <meta name="twitter:image" content="@($"{Context.Request.Scheme}://{Context.Request.Host}{logoUrl}")" />
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />

<style>
    .document-paper {
        background: #fff;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1), 0 6px 20px rgba(0,0,0,0.1);
        border: 1px solid #ddd;
        margin: 20px auto;
        max-width: 1200px;
        min-height: 600px;
        position: relative;
    }
    
    .document-paper::before {
        content: '';
        position: absolute;
        left: 40px;
        top: 0;
        bottom: 0;
        width: 2px;
        background: #ff9999;
        z-index: 1;
    }
    
    .document-header {
        border-bottom: 3px double #333;
        padding: 20px 60px;
        text-align: center;
        background: linear-gradient(to bottom, #f9f9f9, #fff);
        position: relative;
    }
    
    .company-info {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
        gap: 15px;
    }
    
    .company-logo {
        width: 60px;
        height: 60px;
    }
    
    .company-name {
        font-size: 20px;
        font-weight: bold;
        color: #2c3e50;
    }
    
    .document-content {
        padding: 40px 60px;
        line-height: 1.0;
        font-family: 'Tahoma', sans-serif;
        position: relative;
        background: repeating-linear-gradient(
            transparent,
            transparent 35px,
            #e8f4fd 35px,
            #e8f4fd 36px
        );
    }
    
    .document-title {
        font-size: 24px;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 10px;
        text-decoration: underline;
    }
    
    .customer-info {
        font-size: 16px;
        color: #7f8c8d;
        margin-bottom: 30px;
    }
    
    .document-row {
        display: flex;
        margin-bottom: 0;
        align-items: center;
        height: 36px;
        position: relative;
    }
    
    .document-label {
        font-weight: bold;
        width: 150px;
        color: #34495e;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        height: 100%;
    }
    
    .document-value {
        flex: 1;
        color: #2c3e50;
        display: flex;
        align-items: center;
        height: 100%;
    }
    
    .overview-section {
        margin: 30px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #e9ecef;
    }
    
    .overview-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 15px;
        color: #2c3e50;
        border-bottom: 2px solid #3498db;
        padding-bottom: 5px;
    }
    
    .overview-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
    }
    
    .overview-item {
        text-align: center;
        padding: 15px;
        background: white;
        border-radius: 6px;
        border: 1px solid #dee2e6;
    }
    
    .overview-number {
        font-size: 24px;
        font-weight: bold;
        color: #3498db;
        margin-bottom: 5px;
    }
    
    .overview-label {
        font-size: 14px;
        color: #6c757d;
    }
    
    .currency-pairs-section {
        margin: 30px 0;
    }
    
    .pairs-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }
    
    .pair-card {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        text-align: center;
    }
    
    .pair-name {
        font-size: 16px;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 10px;
    }
    
    .pair-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }
    
    .pair-stat {
        padding: 8px;
        background: #f8f9fa;
        border-radius: 4px;
    }
    
    .pair-count {
        font-size: 14px;
        color: #6c757d;
    }
    
    .pair-amount {
        font-size: 12px;
        color: #28a745;
        font-weight: bold;
    }
    
    .transactions-section {
        margin-top: 30px;
    }
    
    .table-container {
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .table th {
        background-color: #3498db;
        color: white;
        border: none;
        text-align: center;
        padding: 12px 8px;
        font-weight: bold;
    }
    
    .table td {
        text-align: center;
        padding: 10px 8px;
        border-bottom: 1px solid #dee2e6;
        font-size: 14px;
    }
    
    .table tbody tr:hover {
        background-color: #f8f9fa;
    }
    
    .print-button {
        text-align: center;
        margin: 30px 0;
    }
    
    .print-btn {
        background: #3498db;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
    }
    
    .print-btn:hover {
        background: #2980b9;
    }
    
    @@media print {
        body {
            margin: 0;
            padding: 0;
            background: white;
        }
        
        .document-paper {
            box-shadow: none;
            border: none;
            margin: 0;
            max-width: none;
        }
        
        .print-button {
            display: none;
        }
    }
</style>
</head>

<body>
    <div class="document-paper">
        <div class="document-header">
            <div class="company-info">
                <img src="@logoUrl" alt="لوگو" class="company-logo" />
                <div>
                    <div class="company-name">@websiteName</div>
                    <div style="font-size: 14px; color: #7f8c8d;">گزارش تراکنش‌های مشتری</div>
                </div>
            </div>
        </div>

        <div class="document-content">
            <div class="document-title">صورت حساب معاملات</div>
            <div class="customer-info">@Model.Customer.FullName - تاریخ صدور: @Model.StatementDate.ToPersianDateTextify()</div>

            <div class="document-row">
                <div class="document-label">نام مشتری:</div>
                <div class="document-value">@Model.Customer.FullName</div>
            </div>
            
            <div class="document-row">
                <div class="document-label">کد ملی:</div>
                <div class="document-value">@Model.Customer.NationalId</div>
            </div>
            
            <div class="document-row">
                <div class="document-label">شماره تماس:</div>
                <div class="document-value">@Model.Customer.PhoneNumber</div>
            </div>
            
            <div class="document-row">
                <div class="document-label">تاریخ صورت حساب:</div>
                <div class="document-value">@Model.StatementDate.ToPersianDateTextify()</div>
            </div>

            <!-- Overview Section -->
            <div class="overview-section">
                <div class="overview-title">خلاصه آماری</div>
                <div class="overview-grid">
                    <div class="overview-item">
                        <div class="overview-number">@Model.Orders.Count</div>
                        <div class="overview-label">تعداد کل معاملات</div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-number">@Model.CurrencyPairStats.Count</div>
                        <div class="overview-label">تعداد جفت ارزها</div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-number">@Model.MonthlyStats.Count</div>
                        <div class="overview-label">ماه‌های فعالیت</div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-number">@string.Format("{0:N0}", Model.Orders.Sum(o => o.ToAmount))</div>
                        <div class="overview-label">کل حجم معاملات</div>
                    </div>
                </div>
            </div>

            <!-- Currency Pairs Section -->
            @if (Model.CurrencyPairStats.Any())
            {
                <div class="currency-pairs-section">
                    <div class="overview-title">تحلیل جفت ارزها</div>
                    <div class="pairs-grid">
                        @foreach (var pair in Model.CurrencyPairStats)
                        {
                            <div class="pair-card">
                                <div class="pair-name">@pair.FromCurrency/@pair.ToCurrency</div>
                                <div class="pair-stats">
                                    <div class="pair-stat">
                                        <div class="pair-count">@pair.TotalTransactions معامله</div>
                                    </div>
                                    <div class="pair-stat">
                                        <div class="pair-amount">@string.Format("{0:N2}", pair.TotalAmount)</div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }

            <!-- Transactions Table -->
            @if (Model.Orders.Any())
            {
                <div class="transactions-section">
                    <div class="overview-title">لیست معاملات</div>
                    <div class="table-container">
                        <table class="table table-striped mb-0">
                            <thead>
                                <tr>
                                    <th>تاریخ</th>
                                    <th>جفت ارز</th>
                                    <th>از ارز</th>
                                    <th>مقدار</th>
                                    <th>به ارز</th>
                                    <th>مقدار کل</th>
                                    <th>نرخ</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var order in Model.Orders.OrderByDescending(o => o.CreatedAt))
                                {
                                    <tr>
                                        <td>@order.CreatedAt.ToPersianDateTextify()</td>
                                        <td>@order.CurrencyPair</td>
                                        <td>@order.FromCurrency.Code</td>
                                        <td>@string.Format("{0:N2}", order.FromAmount)</td>
                                        <td>@order.ToCurrency.Code</td>
                                        <td>@string.Format("{0:N2}", order.ToAmount)</td>
                                        <td>@string.Format("{0:N4}", order.Rate)</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            }

            <!-- Footer Information -->
            <div style="margin-top: 40px; text-align: center; font-size: 12px; color: #7f8c8d; border-top: 1px solid #dee2e6; padding-top: 20px;">
                <p><strong>گزارش تراکنش‌ها در تاریخ @DateTime.Now.ToPersianDateTextify() صادر شده است.</strong></p>
                <p>برای هرگونه سؤال یا ابهام با @websiteName تماس بگیرید.</p>
                <p style="margin-top: 10px;"><strong>آدرس وب‌سایت:</strong> @companyWebsite</p>
            </div>

            <div class="print-button">
                <button class="print-btn" onclick="window.print()">
                    <i class="fas fa-print"></i> چاپ گزارش
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
